<!doctype html><meta charset="utf-8">
<title>unglued</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
*,*::before,*::after{ box-sizing: border-box }

:root{ --bg:#0b0c0e; --fg:#e6e6e6; --muted:#c8c8c8; --card:#0f1115; --border:#1b1f2a; --link:#9ecbff; }
@media (prefers-color-scheme:light){
  :root{ --bg:#ffffff; --fg:#111; --muted:#444; --card:#f8f9fb; --border:#e5e7eb; --link:#0b57d0; }
}

body{font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,sans-serif;margin:0;background:var(--bg);color:var(--fg)}
main{max-width:900px;margin:0 auto;padding:24px}
label{display:block;margin:.5rem 0 .25rem;color:var(--muted)}

textarea,input,select,button{
  width:100%; display:block;
  padding:.75rem; border-radius:12px; border:1px solid var(--border);
  background:var(--card); color:var(--fg)
}

button{cursor:pointer;font-weight:600}
.row{display:grid; grid-template-columns:1fr; gap:12px}
.card{background:var(--card);padding:20px;border:1px solid var(--border);border-radius:16px;box-shadow:0 6px 20px rgba(0,0,0,.12)}
small{opacity:.7}
a{color:var(--link);text-decoration:none} a:hover{text-decoration:underline}
.inline{display:flex;gap:12px;align-items:center}
.checkbox{display:flex;gap:8px;align-items:center}

.codeeditor{
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  tab-size: 2;                /* Darstellung von \t */
  -moz-tab-size: 2;
  white-space: pre;
  resize: vertical;
}


.topbar{display:flex;justify-content:space-between;align-items:baseline;margin:0 0 8px 0}
.stats{font-size:14px;opacity:.8}

/* Themed modal */
dialog.modal { 
  padding: 0;
  border: 0;
  background: transparent;       /* let our sheet define colors */
  color-scheme: dark light;       /* play nice with UA controls */
}
dialog.modal::backdrop{
  background: rgba(0,0,0,.55);
  backdrop-filter: blur(2px);
}

/* The inner card */
.modal .sheet{
  background: var(--card);
  color: var(--fg);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 18px 20px;
  max-width: 720px;
  box-shadow: 0 16px 60px rgba(0,0,0,.45);
}

/* Title + content */
.modal h3{ margin: 0 0 .5rem 0; font-size: 18px }
.modal .muted{
  color: var(--muted);
  background: rgba(255,255,255,.03);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 10px 12px;
  white-space: pre-wrap;
  overflow-wrap: anywhere;
}

/* Buttons */
.modal .actions{ display:flex; gap:8px; justify-content:flex-end; margin-top:12px }
.modal .btn{
  border: 1px solid var(--border);
  background: var(--card);
  color: var(--fg);
  padding: .45rem .8rem;
  border-radius: 10px;
  cursor: pointer;
}
.modal .btn:hover{ filter: brightness(1.05) }



</style>
<main>
  <h1>unglued</h1>
    <div class="stats">
    Aktuell {{.Alloc}} von {{.Sys}} (OS) · Pastes: {{.Count}}
  </div>
  <div class="card">
    <form method="post" action="/paste">

      <label for="lang">Sprache</label>
      <select id="lang" name="lang">
        {{range .Langs}}<option value="{{.}}">{{.}}</option>{{end}}
      </select>

      <label for="theme">Theme (Default)</label>
      <select id="theme" name="theme">
        <option value="dark" selected>Dark</option>
        <option value="light">Light</option>
      </select>

      <label for="code">Code / Text</label>
      <textarea id="code" name="code" rows="16" class="codeeditor"
  spellcheck="false" autocapitalize="off" autocomplete="off" autocorrect="off"
  placeholder="Füge deinen Code hier ein…"></textarea>


      <div class="row">
        <div>
          <label for="ttl">Ablauf</label>
          <select id="ttl" name="ttl">
            <option value="1h">1 Stunde</option>
            <option value="24h" selected>24 Stunden</option>
            <option value="168h">7 Tage</option>
          </select>
        </div>
        <div>
          <label for="author">Name (optional)</label>
          <input id="author" name="author" value="{{.Author}}" placeholder="Dein Name oder Nick">
          <div class="checkbox" style="margin-top:.5rem">
            <input id="editable" type="checkbox" name="editable">
            <label for="editable" style="margin:0">Editierbar (nur mit geheimem Link / Cookie)</label>
          </div>
        </div>
      </div>

      <div style="text-align:right;margin-top:12px">
        <button type="submit">Link erzeugen</button>
      </div>

      <small>API: POST /api/paste – JSON-Felder: code, lang, ttl, theme, editable, author.</small>
    </form>


    <dialog id="msgDialog" class="modal">
  <form method="dialog" class="sheet">
    <h3 id="msgTitle">Message</h3>
    <pre id="msgBody" class="muted"></pre>
    <div class="actions">
      <button class="btn" value="cancel">OK</button>
    </div>
  </form>
</dialog>


<script>
(function () {
  const form = document.querySelector('form[action="/paste"]');
  if (!form) return;

  const dlg   = document.getElementById('msgDialog');
  const title = document.getElementById('msgTitle');
  const body  = document.getElementById('msgBody');

  function showMsg(t, txt) {
    title.textContent = t;
    body.textContent  = txt;
    dlg.showModal();
  }

  dlg.addEventListener('close', () => document.getElementById('code')?.focus());
  dlg.addEventListener('cancel', (e) => { e.preventDefault(); dlg.close(); });

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const fd = new FormData(form);

    try {
      const res = await fetch('/paste', { method: 'POST', body: fd });

      if (!res.ok) {
        const txt = await res.text();
        if (txt.toLowerCase().includes('secret')) {
          showMsg('Potential secrets detected', txt);
        } else {
          showMsg('Error', txt);      // <-- statt alert()
        }
        return;
      }

      // Erfolg: Redirect übernehmen
      if (res.redirected) window.location.href = res.url;
      else window.location.reload(); // Fallback
    } catch {
      showMsg('Network error', 'Bitte später erneut versuchen.');
    }
  });
})();

</script>


</main>

